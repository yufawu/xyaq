<template>    <div class="container">        <div class="body">            <img class="logo" src="../assets/logo.png">            <div class="form">                <div class="user_name" :class="{ inputActive: isNameFocus }">                    <img src="../assets/login/user_name_icon.png" class="user_name_icon">                    <input type="text" class="user_name_text" placeholder="账号/手机号" v-model="userName"                           @focus="nameFocus($event)" @blur="nameBlur" ref="nameInput">                </div>                <div class="user_pwd" :class="{ inputActive: isPwdFocus }">                    <img src="../assets/login/password_icon.png" class="user_pwd_icon">                    <input type="password" class="user_pwd_text" placeholder="登陆密码" v-model="userPwd"                           @focus="pwdFocus($event)" @blur="pwdBlur" ref="pwdInput">                </div>            </div>            <button class="submit" @click="submit">登录</button>            <p class="experience" @click="experience">进入体验</p>        </div>        <div v-if="isShowSelectAccount" class="select">            <div class="select_title">请选择你的登录账号</div>            <ul>                <li v-for="(item,index) in accountArray" :key="index" @click="selectAccount(item.LoginName, index)">                    <div class="select_name">{{ item.LoginName }}</div>                    <div class="select_name">{{ item.AccountName }}</div>                </li>            </ul>        </div>        <!--灰色遮罩层-->        <div class="mask" v-if="isShowSelectAccount" @click="closeSelect" @touchmove.prevent></div>        <p class="footer">深圳安捷互联有限公司</p>    </div></template><script>    import CryptoJS from 'crypto-js'    import * as api from '../constant/api'    import * as types from '../constant/types'    export default {        name: 'Login',        data() {            return {                userName: '',//用户名                userPwd: '',//密码                entryUserPwd: '',//加密后的密码                isNameFocus: false,//用户名输入框是否获取焦点                isPwdFocus: false,//密码输入框是否获取焦点                accountArray: [],//一个手机号关联的多个账号                isShowSelectAccount: false,//是否显示账号选择框                baseURL: '/',                ent_type: '1',//账户类型   1：教育局   2：学校            }        },        methods: {            //DES加密            encryptByDES(message, key) {                const keyHex = CryptoJS.enc.Utf8.parse(key);                const encrypted = CryptoJS.DES.encrypt(message, keyHex, {                    mode: CryptoJS.mode.ECB,                    padding: CryptoJS.pad.Pkcs7                });                return encrypted.toString();            },            submit() {//提交验证                if (null == this.userName || '' == this.userName) {                    this.$bottomToast('请输入用户名')                    this.$refs.nameInput.focus();//让用户名输入框获取焦点                    return                }                if (null == this.userPwd || '' == this.userPwd) {                    this.$toast('请输入密码');                    this.$refs.pwdInput.focus();//让密码输入框获取焦点                    return                }                //对密码进行DES加密                this.entryUserPwd = this.encryptByDES(this.userPwd, '20161219');                this.choiceServer();            },            choiceServer() {//获取运营平台(获取baseURL)【后面不用这个了】                // let params = {'username': this.userName};                // this.http(this, api.CHOICE_SERVER, params, (res) => {                //     if (res.status == 1) {                //         this.baseURL = res.host + '/';                //         this.choicePhone();                //     } else {                //         this.$bottomToast(res.msg);                //     }                // })                this.baseURL = api.BASE_URL;                this.choicePhone();            },            choicePhone() {                let phoneParams = {'iphone': this.userName}                //验证该手机号关联多少个账号                this.http(this, this.baseURL + api.CHOICE_PHONE_LOGIN, phoneParams, (res) => {                    if (res.status == 1) {                        if (res.data.length == 1) {                            this.ent_type = res.data[0].type;                            this.login(this.userName);                        } else {                            this.accountArray = [];                            this.accountArray = this.accountArray.concat(res.data);                            this.isShowSelectAccount = true;                        }                    } else {                        this.$bottomToast('该账号不存在');                        this.$refs.nameInput.focus();//让用户名输入框获取焦点                    }                })            },            selectAccount(name, index) {//选择登录账号                this.login(name);                this.ent_type = this.accountArray[index].type;                this.isShowSelectAccount = false;            },            login(name, isExperience) {//执行登录操作                let params = {                    'username': name,                    'password': this.entryUserPwd,                    'deviceid': '1',                    'version': '1.0.0'                }                this.http(this, this.baseURL + api.CHECK_LOGIN, params, (res) => {                    if (res.status == 1) {                        let userInfo = {                            'accountID': res.data.AccountID,//机构id                            'accountName': res.data.AccountName,//机构名称                            'loginName': res.data.LoginName,                            'PID': res.data.PID,                            'phone': res.data.iphone,                            'email': res.data.email,                            'isGroup': res.data.isGroup,                            'isIm': res.data.isIm,                            'isLeader': res.data.isLead,//是否为领导                            'sex': res.data.sex,//性别                            'sign': res.data.sign,                            'baseURL': this.baseURL,//API接口baseURL                            'type': res.data.ent_type,//机构类型 1教育局 2学校                            'headImg': res.data.avatar || require('../assets/mine/head_default.png'),                            'userName': res.data.UserName,//用户昵称                            'isExperience': isExperience || false, //是否为体验账号                            'job': res.data.job //职位 1局领导 2安保科科长 3安保科科员 4校长 5安全主任 6安全员                        };                        this.$store.dispatch(types.SET_USER_INFO, userInfo);                        //判断是否需要重定向到登录前页面                        let redirect = decodeURIComponent(this.$route.query.redirect || '/');                        this.$router.replace({                            path: redirect                        })                        this.$toast('登录成功');                    } else {                        this.$toast(res.msg);                    }                })            },            nameFocus(event) {//用户名输入框获取焦点                this.isNameFocus = true;                event.currentTarget.select();            },            nameBlur() {//用户名输入框失去焦点                this.isNameFocus = false;            },            pwdFocus(event) {//密码输入框获取焦点                this.isPwdFocus = true;                console.log(event)                event.currentTarget.select();            },            pwdBlur() {//密码输入框失去焦点                this.isPwdFocus = false;            },            closeSelect() {                this.isShowSelectAccount = false;            },            experience() {//体验账号登录                this.baseURL = api.BASE_URL;                let isExperience = true;                this.entryUserPwd = this.encryptByDES('123456', '20161219');                this.login(api.EXPERIENCE_ACCOUNT, isExperience);            }        }    }</script><style lang="stylus" scoped>    @import "../style/common.styl"    .container        display flex        flex-direction column        position relative        text-align: center        height 100vh        background white    .body        flex 1    .logo        width 30%        margin-top 30%        margin-bottom 2%    .form {        display: flex        flex-wrap wrap        justify-content center    }    .user_name {        display flex        align-items center        width 70%        solidBorder(main-color)        border-radius 5px;        padding 2%        margin-top 5%    }    .user_name_icon {        width 12%    }    input {        border none        outline none        width 100%        height 100%        cursor pointer        margin-left 3%    }    .user_pwd {        @extend .user_name    }    .user_pwd_icon {        @extend .user_name_icon    }    .submit {        width 70%        background main-color        color #ffffff        border-radius 5px        margin-top 11%        padding 2%        font-size 5vw    }    .submit:active {        background (main-color) - 30%    }    .footer {        width 100%        text-align center        margin-top 20%        margin-bottom 3%    }    .inputActive {        box-shadow inset 0 1px 1px rgba(0, 0, 0, .075), 0 0 8px rgba(102, 175, 233, .6)    }    .select {        position absolute        width 80%        top 20%        left 10%        z-index 1000        background white        border-radius 5px        padding px2vw(10px)    }    .select_title {        width 100%        text-align center        padding px2vw(25px) 0        font-weight bold        borderBottom()    }    .select li {        display flex        align-items center        justify-content left        padding px2vw(25px)        borderBottom()    }    .select_name {        flex 1        width 0        text-align left        textOverflow()    }    .experience {        width 70%        margin-left 15%        text-align right        color main-color        margin-top px2vw(30px)    }</style>